# 浏览器的工作原理及http协议

### 浏览器的组成

　　主要组件包括：

　　1. 用户界面 － 包括地址栏、后退/前进按钮、书签目录等，也就是所看到的除了用来显示所请求页面的主窗口之外的其他部分

　　2. 浏览器引擎 － 用来查询及操作渲染引擎的接口

　　3. 渲染引擎 － 用来显示请求的内容，例如，如果请求内容为html，它负责解析html及css，并将解析后的结果显示出来。

　　4. 网络 － 用来完成网络调用，例如http请求，它具有平台无关的接口，可以在不同平台上工作。

　　5. UI后端 － 用来绘制类似组合选择框及对话框等基本组件，具有不特定于某个平台的通用接口，底层使用操作系统的用户接口。

　　6. JS解释器 － 用来解释执行JS代码。

　　7. 数据存储 － 属于持久层，浏览器需要在硬盘中保存类似cookie的各种数据，HTML5定义了web database技术，这是一种轻量级完整的客户端存储技术。

---



#### 浏览器内核

　　浏览器内核分成两部分：渲染引擎和js引擎，由于js引擎越来越独立，内核就倾向于只指渲染引擎，负责请求网络页面资源加以解析排版并呈现给用户

　　默认情况下，渲染引擎可以显示html、xml文档及图片，它也可以借助插件显示其他类型数据，例如使用PDF阅读器插件，可以显示PDF格式。

---



### 渲染流程

从资源的下载到最终的页面展现，渲染流程可简单地理解成一个线性串联的变换过程的组合，原始输入为URL地址，最终输出为页面Bitmap，中间依次经过了Loader、Parser、Layout和Paint模块

- Loader模块负责处理所有的HTTP请求以及网络资源的缓存，相当于是从URL输入到Page Resource输出的变换过程。
- Parser模块主要负责解析HTML页面，完成从HTML文本到HTML语法树再到文档对象树（Document Object Model Tree，DOM Tree）的映射过程，并且会解析CSS，以及对javascirpt的解析。

- Layout过程就是排版，它包含两大过程：创建渲染(Render)树，计算布局。
- paint模块就是绘制图像了。

---

## HTTP协议

首先http协议是应用层的协议。它是构建在 TCP/IP协议之上的，是TCP/IP协议的一个子集，用于客户端和服务器之间的通信，默认80端口。

相对于TCP/IP 协议，http协议是无状态的。但是有时候我们后续的连接需要之前提供的信息所以有了 Cookie和 Session 技术。Cookie是保存在本地浏览器的，而Session是保存在服务端的。

---

### 工作流程

整个基本的工作流程是客户端发送一个HTTP请求，说明客户端想要访问的资源和请求的动作，服务端收到请求之后，服务端开始处理请求，并根据请求做出相应的动作访问服务器资源，最后通过发送HTTP响应把结果返回给客户端。

---

#### HTTP请求

  HTTP请求是客户端往服务端发送请求动作，告知服务器自己的要求。

HTTP请求由状态行，请求头，请求正文三部分组成。

- 状态行：包括请求方式，资源路径，协议版本；
- 请求头：包括一些访问的域名，用户代理，Cookie等信息。
- 请求正文：就是HTTP请求的数据。

请求方式一般有：GET , POST , PUT , DELETE 等。

---

#### HTTP响应

服务器收到了客户端发来的HTTP请求后，根据HTTP请求中的动作要求，服务端做出具体的动作，将结果回应给客户端，称为HTTP响应。

HTTP响应由三部分组成：状态行，响应头，响应正文。

- 状态行：包括协议版本Version，状态码，回应短语。
- 响应头：包括搭建服务器的软件，发送响应时间，回应数据的格式等信息。
- 响应正文：就是响应的具体数据。

状态码，不同的状态码代表不同的含义，如：
| 状态码 | 描述 |
| ---- | ----------------------------------- |
| 1xx  | 表示HTTP请求已经接受，继续处理请求  |
| 2xx  | 表示HTTP请求已经处理完成            |
| 3xx  | 表示把请求访问的URL重定向到其他目录 |
| 4xx  | 表示客户端出现错误                  |
| 5xx  | 表示服务端出现错误                  |